<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç•™è¨€æ¿</title>
    <!-- Bootstrap æ¨£å¼ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h1 class="mb-4">ç•™è¨€æ¿</h1>

{% if user.is_authenticated %}
  <p>ğŸ‘‹ æ­¡è¿ï¼Œ{{ user.username }}ï¼
    <a href="#" onclick="document.getElementById('logout-form').submit();">ç™»å‡º</a>
  </p>
  <form id="logout-form" action="{% url 'logout' %}" method="post" style="display: none;">
    {% csrf_token %}
  </form>
{% else %}
  <p><a href="{% url 'login' %}">ç™»å…¥</a></p>
{% endif %}

<!-- è¡¨å–®éŒ¯èª¤æç¤º -->
{% if form.errors %}
    <div class="alert alert-danger">
        è«‹æª¢æŸ¥è¡¨å–®å…§å®¹æ˜¯å¦æ­£ç¢ºï¼
    </div>
{% endif %}

<!-- ç•™è¨€è¡¨å–®é–‹å§‹ -->
<form method="GET" class="mb-4">
    <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="æœå°‹ç•™è¨€å…§å®¹" value="{{ query }}">
        <button type="submit" class="btn btn-outline-secondary">æœå°‹</button>
    </div>
</form>

<form method="GET" class="mb-4">
    <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="æœå°‹ç•™è¨€å…§å®¹" value="{{ query }}">
        <select name="sort" class="form-select">
            <option value="newest" {% if sort == 'newest' %}selected{% endif %}>æœ€æ–°ç•™è¨€</option>
            <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>æœ€èˆŠç•™è¨€</option>
            <option value="likes" {% if sort == 'likes' %}selected{% endif %}>æœ€å¤šè®š</option>
        </select>
        <button type="submit" class="btn btn-outline-secondary">æœå°‹ / æ’åº</button>
    </div>
</form>

<form method="POST" class="mb-4">
    {% csrf_token %}
    <div class="mb-3">
        {{ form.name.label_tag }}
        {{ form.name }}
        {% for error in form.name.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>
    <div class="mb-3">
        {{ form.message.label_tag }}
        {{ form.message }}
        {% for error in form.message.errors %}
            <div class="text-danger">{{ error }}</div>
        {% endfor %}
    </div>
    <button type="submit" class="btn btn-primary">é€å‡ºç•™è¨€</button>
</form>
<hr>
<!-- ç•™è¨€è¡¨å–®çµæŸ -->

<!-- ç•™è¨€åˆ—è¡¨ -->
{% for message in messages %}
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">{{ message.name }} èªªï¼š</h5>
            <p class="card-text">{{ message.message }}</p>
            <p class="card-text">
                <small class="text-muted">
                  æ™‚é–“ï¼š{{ message.updated_at|date:"Y-m-d H:i" }}
                  {% if message.updated_at != message.created_at %}
                    ï¼ˆå·²ç·¨è¼¯ï¼‰
                  {% endif %}
                </small>
              </p>
              
              
            <p class="card-text"><small class="text-muted">ç”¨æˆ¶ï¼š{{ message.user.username }}</small></p>
            <p class="card-text"><small class="text-muted">ç•¶å‰ç”¨æˆ¶ï¼š{{ user.username }}</small></p>

            <!-- æŒ‰è®šæŒ‰éˆ• -->
            <form action="{% url 'like_message' message.id %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-primary btn-sm">
                    ğŸ‘ {{ message.likes.count }} è®š
                </button>
            </form>

            {% if message.user == user %}
                <a href="{% url 'delete_message' message.id %}" class="btn btn-danger btn-sm">åˆªé™¤</a>
                <a href="{% url 'edit_message' message.id %}" class="btn btn-secondary btn-sm">ä¿®æ”¹</a>
            {% endif %}
        </div>
    </div>
{% empty %}
    <p>ç›®å‰æ²’æœ‰ç•™è¨€ã€‚</p>
{% endfor %}

<!-- åˆ†é æŒ‰éˆ•é–‹å§‹ -->
<nav aria-label="ç•™è¨€åˆ†é ">
    <ul class="pagination">
      {% if messages.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ messages.previous_page_number }}">ä¸Šä¸€é </a>
        </li>
      {% endif %}
  
      <li class="page-item active">
        <span class="page-link">
          ç¬¬ {{ messages.number }} é  / å…± {{ messages.paginator.num_pages }} é 
        </span>
      </li>
  
      {% if messages.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ messages.next_page_number }}">ä¸‹ä¸€é </a>
        </li>
      {% endif %}
    </ul>
</nav>
<!-- åˆ†é æŒ‰éˆ•çµæŸ -->
</body>
</html>
